<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.3 on Wed Sep 14 19:26:33 2011 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>hiihat_check_file.pro (HiiHAT)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="hiihat_check_file.pro (HiiHAT)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; File checking function for hiihat ui. Parameter read or write should be set </span>
<span class="comments">; depending on whether the selected file is an input or an output file. Title is the name</span>
<span class="comments">; given to the envi_pickfile dialog box and any error dialog boxes that will be generated if</span>
<span class="comments">; errmsg is not equal to \"\".</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   util </span>
<span class="comments">;</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;  read: in, required, type=boolean</span>
<span class="comments">;   check read permissions</span>
<span class="comments">;  write: in, required, type=boolean</span>
<span class="comments">;   check write permissions</span>
<span class="comments">;</span>
<span class="comments">; :Returns:</span>
<span class="comments">;  0 if file is not accessible (or is a directory) (read/write)</span>
<span class="comments">;  1 if file is accessible (read) and does not already exist (write)</span>
<span class="comments">;  2 if file is accessible and already exists (write)</span>
<span class="comments">;</span>
<span class="comments">; :Examples: </span>
<span class="comments">;  The following code will check to see if fname is readable.</span>
<span class="comments">;   fname=envi_pickfile()</span>
<span class="comments">;   readable=hiihat_check_file(fname,read=1)</span>
<span class="comments">;   if readable ne 0 then print, "File is readable"</span>
<span class="comments">; </span>
<span class="comments">; :History:</span>
<span class="comments">;   Dec 12, 2010 (BDB): docstr added.</span>
<span class="comments">;</span>
<span class="comments">; :Author: Brian D. Bue</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;  Copyright 2010, by the California Institute of Technology. ALL RIGHTS</span>
<span class="comments">;  RESERVED. United States Government Sponsorship acknowledged. Any commercial</span>
<span class="comments">;  use must be negotiated with the Office of Technology Transfer at the</span>
<span class="comments">;  California Institute of Technology.</span>
<span class="comments">; </span>
<span class="comments">;  This software may be subject to U.S. export control laws and regulations.  By</span>
<span class="comments">;  accepting this document, the user agrees to comply with all applicable U.S.</span>
<span class="comments">;  export laws and regulations.  User has the responsibility to obtain export</span>
<span class="comments">;  licenses, or other export authority as may be required before exporting such</span>
<span class="comments">;  information to foreign countries or providing access to foreign persons.</span>
<span class="comments">;-</span>
<a id="hiihat_check_file:source"></a>function hiihat_check_file, filename, read=read, write=write
    if not keyword_set(read) then read=0
    if not keyword_set(write) then write=0

    if filename eq "" then return, 0 

    finfo = file_info(filename)
    
    <span class="comments">;; we don't like directories here, reject them as valid files</span>
    if finfo.EXISTS and finfo.DIRECTORY then return, 0

    if read then begin
       if (not finfo.EXISTS) or (finfo.EXISTS and not finfo.READ) then begin
          return, 0
       endif
    endif

    if write then begin      
       if finfo.EXISTS then begin 
          if finfo.WRITE then begin
             return, 2
             <span class="comments">;;ok = dialog_message("File exists, overwrite?", title=title, /cancel)</span>
             <span class="comments">;;if not (strupcase(ok) eq 'CANCEL') then return, filename </span>
          endif
          return, 0 <span class="comments">;; user cancelled or we can't write to the existing file</span>
       endif

       <span class="comments">;; still need to check if nonexistent file is writable</span>
       openw, lun, filename, error=cannot_open, /append, /get_lun
       if (cannot_open ne 0) or (keyword_set(lun) eq 0) then begin 
          return, 0
       endif else begin 
          <span class="comments">;; sucessfully allocated a lun for the nonexistent file, free it          </span>
          free_lun, lun 
          temp=size(temporary(lun)) <span class="comments">;; undefine lun</span>
       endelse
    endif

    return, 1
end
</code>
    </div>
  </body>
</html>