<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.3 on Wed Sep 14 19:26:33 2011 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>hiihat_divide_mean.pro (HiiHAT)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="hiihat_divide_mean.pro (HiiHAT)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; Divide image by mean or mean column spectrum</span>
<span class="comments">;</span>
<span class="comments">; :Categories: util </span>
<span class="comments">;</span>
<span class="comments">; :Params:</span>
<span class="comments">;   image, in, required, type="fltarr(ns,nl,nb)"</span>
<span class="comments">;    image to filter</span>
<span class="comments">;   div_type, in, required, type=string</span>
<span class="comments">;    type of division to perform, "None", "Spatial Mean", "Spectral</span>
<span class="comments">;    Mean", or "Spectrum"</span>
<span class="comments">;</span>
<span class="comments">; :Returns:</span>
<span class="comments">;   filtered copy of image</span>
<span class="comments">; </span>
<span class="comments">; :Examples:</span>
<span class="comments">;   The following code divides the mean spectrum out of image I</span>
<span class="comments">;</span>
<span class="comments">;   hiihat_divide_mean, I, "Spectral Mean"</span>
<span class="comments">;</span>
<span class="comments">; :Author: Lukas Mandrake and Brian Bue</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   2009 (LM): code initially written in hiihat_preprocess.pro</span>
<span class="comments">;</span>
<span class="comments">;   Dec 05, 2010 (BDB): routine created from proprocessing code</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;  Copyright 2009, by the California Institute of Technology. ALL RIGHTS</span>
<span class="comments">;  RESERVED. United States Government Sponsorship acknowledged. Any commercial</span>
<span class="comments">;  use must be negotiated with the Office of Technology Transfer at the</span>
<span class="comments">;  California Institute of Technology.</span>
<span class="comments">; </span>
<span class="comments">;  This software may be subject to U.S. export control laws and regulations. By</span>
<span class="comments">;  accepting this document, the user agrees to comply with all applicable U.S.</span>
<span class="comments">;  export laws and regulations.  User has the responsibility to obtain export</span>
<span class="comments">;  licenses, or other export authority as may be required before exporting such</span>
<span class="comments">;  information to foreign countries or providing access to foreign persons.</span>
<span class="comments">;-</span>
<a id="hiihat_divide_mean:source"></a>pro hiihat_divide_mean, image, div_type, denom_spectrum=denom_spectrum
  title='hiihat_divide_mean'
  debug =  hiihat_get_config_parm('debug')
  if debug then print, "Entering "+title

  if div_type eq "None" then goto, cleanup

  n_samples = (size(image))[1]
  n_lines = (size(image))[2]
  n_bands = (size(image))[3]

  envi_report_init, "Mean Division", base=base, /INTERRUPT, title=title 
  envi_report_inc, base, n_bands-1

  mod_step = round(n_bands/10)

  <span class="comments">;; divide by mean spectrum</span>
  <span class="comments">;; but you've got to do better than this...</span>
  <span class="comments">;; you can't let negative values into your averaging, unfortunately,</span>
  <span class="comments">;; making the entire calculation take a ton more time</span>
  if div_type eq "Spatial Mean" then begin
     for j=0,(n_bands-1) do begin
        band_sum   = 0.0
        band_count = 0.0
        if j mod mod_step eq 0 then begin        
           envi_report_stat, base, j, n_bands-1, cancel=cancel   
           if cancel then goto, cleanup     
        endif
        for x=0,n_samples-1 do begin
           for y=0,n_lines-1 do begin
              if image[x, y, j] gt 0.0 then begin
                 band_sum = band_sum + image[x,y,j]
                 band_count = band_count + 1.0
              endif
           endfor
        endfor
        image[*,*,j] = image[*,*,j]/band_sum * band_count
     endfor
  endif else if div_type eq "Spectral Mean" then begin
     <span class="comments">;; divide by mean spectrum FOR EACH COLUMN</span>
     <span class="comments">;; but you've got to do better than this...</span>
     <span class="comments">;; you can't let negative values into your averaging, unfortunately,</span>
     <span class="comments">;; making the entire calculation take a ton more time</span>
     <span class="comments">;; column dependence is to remove striping noise effects</span>
     for j=0,(n_bands-1) do begin
        if j mod mod_step eq 0 then begin        
           envi_report_stat, base, j, n_bands-1, cancel=cancel   
           if cancel then goto, cleanup     
        endif
        for x=0,n_samples-1 do begin
           <span class="comments">;; print, x, j</span>
           band_sum   = 0.0
           band_count = 0.0
           for y=0,n_lines-1 do begin
              if image[x, y, j] gt 0.0 then begin
                 band_sum = band_sum + image[x,y,j]
                 band_count = band_count + 1.0
              endif
           endfor
           image[x,*,j] = image[x,*,j]/band_sum * band_count
        endfor        
     endfor
  endif else if div_type eq "Spectrum" then begin
    <span class="comments">;; divide the image by the given spectrum</span>
    if keyword_set(denom_spectrum) then begin
      for j=0,(n_bands-1) do begin
        image[*,*,j] = image[*,*,j]/denom_spectrum[j]
      endfor
    endif else begin
        print, "Denominator spectrum is not specified."
    endelse
  endif else begin 
     print, "Unknown div_type: ", div_type     
  endelse
  cleanup:
  envi_report_init, base=base, /finish 
  if debug then print, "Exiting "+title
end
</code>
    </div>
  </body>
</html>