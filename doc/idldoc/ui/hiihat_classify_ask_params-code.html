<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.3 on Wed Sep 14 19:26:31 2011 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>hiihat_classify_ask_params.pro (HiiHAT)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="hiihat_classify_ask_params.pro (HiiHAT)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; Routine to query user for image segmentation parameters.</span>
<span class="comments">;</span>
<span class="comments">; :Author: Brian D Bue</span>
<span class="comments">; :Categories: ui</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;  class_method: out, required, type=string</span>
<span class="comments">;    string value for classification method name</span>
<span class="comments">;  method: out, required, type=fix</span>
<span class="comments">;    ENVI value of classification method for CLASS_DOIT function</span>
<span class="comments">;  out_filename: out, optional, type=string</span>
<span class="comments">;    output file name for classification map</span>
<span class="comments">;  in_memory: out, optional, type=boolean</span>
<span class="comments">;    compute classification in memory if out_filename not specified/valid</span>
<span class="comments">;  base_filename: in, optional, type=string</span>
<span class="comments">;    base name of image file to segment, if available</span>
<span class="comments">;  classify_cancel: out, optional, type=boolean</span>
<span class="comments">;    flag to cancel classification operation</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;  Copyright 2011, by the California Institute of Technology. ALL RIGHTS</span>
<span class="comments">;  RESERVED. United States Government Sponsorship acknowledged. Any commercial</span>
<span class="comments">;  use must be negotiated with the Office of Technology Transfer at the</span>
<span class="comments">;  California Institute of Technology.</span>
<span class="comments">; </span>
<span class="comments">;  This software may be subject to U.S. export control laws and regulations.  By</span>
<span class="comments">;  accepting this document, the user agrees to comply with all applicable U.S.</span>
<span class="comments">;  export laws and regulations.  User has the responsibility to obtain export</span>
<span class="comments">;  licenses, or other export authority as may be required before exporting such</span>
<span class="comments">;  information to foreign countries or providing access to foreign persons.</span>
<span class="comments">;-</span>
<a id="hiihat_classify_ask_params:source"></a>pro hiihat_classify_ask_params, class_method=class_method, method=method, $
                                in_memory=in_memory, out_filename=out_filename, $
                                rule_in_memory=rule_in_memory, rule_out_filename=rule_out_filename, $
                                base_filename=base_filename, classify_cancel=classify_cancel

    <span class="comments">;;Set compiler and debug options</span>
    compile_opt strictarr
    debug = hiihat_get_config_parm('debug')
    gui_status = hiihat_get_config_parm('gui_status')

    title = 'hiihat_classify_ask_params'
    if debug then print, "Entering "+title

    if not keyword_set(base_filename) then begin 
       def_filename='hiihat_class'
    endif else begin
       def_filename=hiihat_strreplace(base_filename,'.img','',ignore_case=1)+'_class'
    endelse

    <span class="comments">;; don't cancel unless user bails out</span>
    classify_cancel = 0
    class_method = 'SAM' <span class="comments">;; use SAM by default</span>
    methods = ['Parallelepiped','Minimum distance','Maximum likelihood',$
               'SAM', 'Mahalanobis', 'Binary Encoding', 'SID']
    method_idx = [0,1,2,3,5,6,8] <span class="comments">;; ENVI indices for methods </span>
    base = widget_auto_base(title='Classification Parameters')  
    nil = widget_pmenu(base, prompt='Method', $
            list=methods, uvalue='method',default=3,/auto)
    nil = widget_outfm(base, prompt="Classification output file", $
                      uvalue='outf', default=def_filename+'.img', /auto)
    nil = widget_outfm(base, prompt="Rule output file", $
                      uvalue='rulef', default=def_filename+'_rule.img', /auto)

    result = auto_wid_mng(base) 
    if (result.accept eq 0) then begin
       classify_cancel=1
       goto, cleanup
    endif

    class_method = methods[result.method]
    method = method_idx[result.method]
    in_memory = result.outf.in_memory
    if not in_memory then begin       
       out_filename = result.outf.name 
       write_status = hiihat_check_file(out_filename,write=1)
       if write_status eq 0 then begin
          dialog = "Invalid output file, computing in memory"
          if not gui_status then print,dialog else ok=dialog_message(dialog,title=title)
          in_memory=1
       endif else if write_status eq 2 then begin
          ok = dialog_message('File "'+out_filename+'" exists, overwrite?', $
                              title=title, /cancel)
          if (strupcase(ok) eq 'CANCEL') then begin
             classify_cancel=1
             goto, cleanup
          endif
       endif
    endif

    rule_in_memory = result.rulef.in_memory
    if not rule_in_memory then begin       
       rule_out_filename = result.rulef.name 
       write_status = hiihat_check_file(rule_out_filename,write=1)
       if write_status eq 0 then begin
          dialog = "Invalid rule output file, computing in memory"
          if not gui_status then print,dialog else ok=dialog_message(dialog,title=title)
          rule_in_memory=1
       endif else if write_status eq 2 then begin
          ok = dialog_message('File "'+rule_out_filename+'" exists, overwrite?', $
                              title=title, /cancel)
          if (strupcase(ok) eq 'CANCEL') then begin
             classify_cancel=1
             goto, cleanup
          endif
       endif
    endif

cleanup:
    if debug then print, "Exiting "+title    
end
   

</code>
    </div>
  </body>
</html>