<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.3 on Wed Sep 14 19:26:31 2011 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>test_hiihat_learn_metric_ut__define.pro (HiiHAT)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="test_hiihat_learn_metric_ut__define.pro (HiiHAT)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="test_hiihat_learn_metric_ut__define:source"></a>pro test_hiihat_learn_metric_ut__define
<span class="comments">;+</span>
<span class="comments">; Unit test entry point definition for metric learning functions.</span>
<span class="comments">; Initializes MGTestCase structure for MGUnit unit test. </span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   testing</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   Jan 7, 2011 (BDB): Initial implementation</span>
<span class="comments">;  </span>
<span class="comments">; :Examples:</span>
<span class="comments">;   This unit test can be run with the following command:</span>
<span class="comments">;</span>
<span class="comments">;   mgunit, 'test_hiihat_learn_metric_ut'</span>
<span class="comments">;</span>
<span class="comments">; :Author: Brian D. Bue</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;  Copyright 2011, by the California Institute of Technology. ALL RIGHTS</span>
<span class="comments">;  RESERVED. United States Government Sponsorship acknowledged. Any commercial</span>
<span class="comments">;  use must be negotiated with the Office of Technology Transfer at the</span>
<span class="comments">;  California Institute of Technology.</span>
<span class="comments">; </span>
<span class="comments">;  This software may be subject to U.S. export control laws and regulations.  By</span>
<span class="comments">;  accepting this document, the user agrees to comply with all applicable U.S.</span>
<span class="comments">;  export laws and regulations.  User has the responsibility to obtain export</span>
<span class="comments">;  licenses, or other export authority as may be required before exporting such</span>
<span class="comments">;  information to foreign countries or providing access to foreign persons.</span>
<span class="comments">;-  compile_opt strictarr</span>
  
  define = { test_hiihat_learn_metric_ut, $
             tmpdir:'', seed:0, verbose:0, debug:0, $
             inherits MGTestCase } 
end

<a id="test_hiihat_learn_metric_ut::test_0_init:source"></a>function test_hiihat_learn_metric_ut::test_0_init
<span class="comments">;+</span>
<span class="comments">; Initialization test and parameters for metric learning functions.</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   testing</span>
<span class="comments">;</span>
<span class="comments">; :Description:</span>
<span class="comments">;   Initializes parameters used by the learn_metricing unit tests and</span>
<span class="comments">;   verifies that the HiiHAT directory is</span>
<span class="comments">;   accessible. This test is run before any other learn_metricing</span>
<span class="comments">;   unit tests are executed. </span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   Jan 7, 2011 (BDB): Initial implementation</span>
<span class="comments">;  </span>
<span class="comments">; :Author: Brian D. Bue</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;  Copyright 2011, by the California Institute of Technology. ALL RIGHTS</span>
<span class="comments">;  RESERVED. United States Government Sponsorship acknowledged. Any commercial</span>
<span class="comments">;  use must be negotiated with the Office of Technology Transfer at the</span>
<span class="comments">;  California Institute of Technology.</span>
<span class="comments">; </span>
<span class="comments">;  This software may be subject to U.S. export control laws and regulations.  By</span>
<span class="comments">;  accepting this document, the user agrees to comply with all applicable U.S.</span>
<span class="comments">;  export laws and regulations.  User has the responsibility to obtain export</span>
<span class="comments">;  licenses, or other export authority as may be required before exporting such</span>
<span class="comments">;  information to foreign countries or providing access to foreign persons.</span>
<span class="comments">;-</span>
  hh_path = hiihat_get_config_parm('hiihat_path')
  assert, file_test(hh_path), "HiiHAT directory missing"
  self.verbose = 0
  self.debug = 0
  self.tmpdir = getenv("IDL_TMPDIR")
  self.seed = 1
  return, 1
end

<a id="test_hiihat_learn_metric_ut::test_split_data:source"></a>function test_hiihat_learn_metric_ut::test_split_data
<span class="comments">;+</span>
<span class="comments">; Tests the split data function given a set of labels</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   testing</span>
<span class="comments">;</span>
<span class="comments">; :Description:</span>
<span class="comments">;   Tests the split data function given a set of labels</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   May 30, 2011 (BDB): Initial implementation</span>
<span class="comments">;  </span>
<span class="comments">; :Author: Brian D. Bue</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;  Copyright 2011, by the California Institute of Technology. ALL RIGHTS</span>
<span class="comments">;  RESERVED. United States Government Sponsorship acknowledged. Any commercial</span>
<span class="comments">;  use must be negotiated with the Office of Technology Transfer at the</span>
<span class="comments">;  California Institute of Technology.</span>
<span class="comments">; </span>
<span class="comments">;  This software may be subject to U.S. export control laws and regulations.  By</span>
<span class="comments">;  accepting this document, the user agrees to comply with all applicable U.S.</span>
<span class="comments">;  export laws and regulations.  User has the responsibility to obtain export</span>
<span class="comments">;  licenses, or other export authority as may be required before exporting such</span>
<span class="comments">;  information to foreign countries or providing access to foreign persons.</span>
<span class="comments">;-</span>
  labels = [intarr(30)+1, intarr(10)+2, intarr(2)+3, intarr(1)+4]

  hiihat_split_data, labels, 2, verbose=self.verbose, $
                     train_idx=fold_tr, test_idx=fold_te
  trlab = labels[fold_tr]
  telab = labels[fold_te]

  utr = trlab[uniq(trlab,sort(trlab))]
  ute = trlab[uniq(telab,sort(telab))]

  assert, total(utr eq [1,2,3,4]) eq 4, 'Incorrectly sampled training data'
  assert, total(ute eq [1,2,3]) eq 3, 'Incorrectly sampled testing data'

  return, 1
end


<a id="test_hiihat_learn_metric_ut::test_classify_mindist:source"></a>function test_hiihat_learn_metric_ut::test_classify_mindist
<span class="comments">;+</span>
<span class="comments">; Tests the mindist classifier on three linearly separable gaussians</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   testing</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   May 30, 2011 (BDB): Initial implementation</span>
<span class="comments">;  </span>
<span class="comments">; :Author: Brian D. Bue</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;  Copyright 2011, by the California Institute of Technology. ALL RIGHTS</span>
<span class="comments">;  RESERVED. United States Government Sponsorship acknowledged. Any commercial</span>
<span class="comments">;  use must be negotiated with the Office of Technology Transfer at the</span>
<span class="comments">;  California Institute of Technology.</span>
<span class="comments">; </span>
<span class="comments">;  This software may be subject to U.S. export control laws and regulations.  By</span>
<span class="comments">;  accepting this document, the user agrees to comply with all applicable U.S.</span>
<span class="comments">;  export laws and regulations.  User has the responsibility to obtain export</span>
<span class="comments">;  licenses, or other export authority as may be required before exporting such</span>
<span class="comments">;  information to foreign countries or providing access to foreign persons.</span>
<span class="comments">;-</span>
  nper = 100

  mu1 = [0,0]
  mu2 = [0,6]
  mu3 = [6,6]

  class1 = randomn(seed,nper,2)
  class1[*,0] += mu1[0]
  class1[*,1] += mu1[1]
  
  class2 = randomn(seed,nper,2)
  class2[*,0] += mu2[0]
  class2[*,1] += mu2[1]

  class3 = randomn(seed,nper,2)
  class3[*,0] += mu3[0]
  class3[*,1] += mu3[1]

  labels = [intarr(nper)+1,intarr(nper)+2,intarr(nper)+3]
  data = [class1,class2,class3]



  hiihat_split_data, labels, 2, verbose=self.verbose, $
                     train_idx=fold_tr, test_idx=fold_te


  tr_dat = data[fold_tr,*]
  te_dat = data[fold_te,*]
  tr_lab = labels[fold_tr]
  te_lab = labels[fold_te]

  pred = hiihat_classify_mindist(tr_dat,tr_lab,te_dat)
  acc = float(total(pred eq te_lab))/n_elements(te_lab)

  if self.verbose then print, "MinDist classifier accuracy:", acc

  assert, acc gt 0.95, 'MinDist accuracy too low'

  return, 1
end

<a id="test_hiihat_learn_metric_ut::test_metric_learning:source"></a>function test_hiihat_learn_metric_ut::test_metric_learning
<span class="comments">;+</span>
<span class="comments">; Tests metric learning in separating two nonspherical gaussians</span>
<span class="comments">;</span>
<span class="comments">; :Categories:</span>
<span class="comments">;   testing</span>
<span class="comments">;</span>
<span class="comments">; :Description:</span>
<span class="comments">;   Tests the metric learning function in separating a pair of</span>
<span class="comments">;   nonspherical gaussians </span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;   May 27, 2011 (BDB): Initial implementation</span>
<span class="comments">;  </span>
<span class="comments">; :Author: Brian D. Bue</span>
<span class="comments">;</span>
<span class="comments">; :Copyright:</span>
<span class="comments">;  Copyright 2011, by the California Institute of Technology. ALL RIGHTS</span>
<span class="comments">;  RESERVED. United States Government Sponsorship acknowledged. Any commercial</span>
<span class="comments">;  use must be negotiated with the Office of Technology Transfer at the</span>
<span class="comments">;  California Institute of Technology.</span>
<span class="comments">; </span>
<span class="comments">;  This software may be subject to U.S. export control laws and regulations.  By</span>
<span class="comments">;  accepting this document, the user agrees to comply with all applicable U.S.</span>
<span class="comments">;  export laws and regulations.  User has the responsibility to obtain export</span>
<span class="comments">;  licenses, or other export authority as may be required before exporting such</span>
<span class="comments">;  information to foreign countries or providing access to foreign persons.</span>
<span class="comments">;-</span>
  nper = 100

  mu1 = [0,0]
  mu2 = [0,3]
  A = [[.166,.5],[.5,2.142]]
  
  choldc, A, P, /double <span class="comments">;; cholesky decompositon</span>

  for j=0, 1 do for i = j, 1 do A[i,j] = 0d <span class="comments">;; leave only lower triangle</span>
  A[(lindgen(2)*3)] = P <span class="comments">;; update diagonal</span>

  <span class="comments">;; generate classes with given covariance</span>
  class1 = A ## randomn(seed,nper,2)
  class1[*,0] += mu1[0]
  class1[*,1] += mu1[1]
  
  class2 = A ## randomn(seed,nper,2)
  class2[*,0] += mu2[0]
  class2[*,1] += mu2[1]
  
  labels = [intarr(nper)+1,intarr(nper)+2]
  data = [class1,class2]

  reg_parms = {reg_type:'constant', lambda:0, lambda_min:0,$
               lambda_max:1, lambda_delta:0.3, num_folds:2}

  A = hiihat_mdmc_xvalidate(data, labels, reg_parms, rank=rank, $
                            verbose=self.verbose)

  hiihat_split_data, labels, 2, verbose=self.verbose, $
                     train_idx=fold_tr, test_idx=fold_te


  tr_dat = data[fold_tr,*]
  te_dat = data[fold_te,*]
  tr_dat_lda = reform(A ## tr_dat, n_elements(fold_tr), rank)
  te_dat_lda = reform(A ## te_dat, n_elements(fold_te), rank)
  tr_lab = labels[fold_tr]
  te_lab = labels[fold_te]

  pred = hiihat_classify_mindist(tr_dat,tr_lab,te_dat)
  acc_euc = float(total(pred eq te_lab))/n_elements(te_lab)

  pred = hiihat_classify_mindist(tr_dat_lda,tr_lab,te_dat_lda)
  acc_lda = float(total(pred eq te_lab))/n_elements(te_lab)

  if self.verbose then begin
     <span class="comments">;; euclidean accuracy should be near 80%</span>
     <span class="comments">;; lda accuracy should be near 90%</span>
     print, 'Euclidean accuracy', acc_euc
     print, 'LDA accuracy', acc_lda

     range = [-6,6]

     plot, class1[*,0],class1[*,1], xr=range,yr=range,color=255, ps=4
     oplot, class2[*,0],class2[*,1],color=100, ps=4
  endif


  assert, acc_euc gt 0.7, 'Euclidean accuracy too low'
  assert, acc_euc lt acc_lda, 'Euclidean accuracy > LDA accuracy'
  assert, acc_lda gt .9 , 'LDA accuracy too low'
  return, 1
end


</code>
    </div>
  </body>
</html>